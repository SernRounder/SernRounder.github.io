---
title: WPA2加密原理
date: 2018-12-28 22:00:11
tags:
- WiFi
- 无线安全
categories: 学习笔记
---
# 简介
WPA全名为Wi-Fi Protected Access，有WPA和WPA2两个标准，是一种保护无线电脑网络（Wi-Fi）安全的系统，它是应研究者在前一代的系统有线等效加密（WEP）中找到的几个严重的弱点而产生的。
<!--more-->
# 加密流程
一般常用的加密为wpa2-psk加密
## WPA-PSK初始化
使用网络名称（SSID）和密码通过pdkdf2_SHA1（密钥，ssid，len（ssid），4096）算法生成PSK和PMK。简单来说就是使用网络名和密码计算生成一个叫psk的东西
## 第一次握手前
AP广播ssid，也就是让我们在WiFi列表里能够看到。
## 第一次握手
如果决定连接，客户端会通过上面的公式计算出一个psk。
但是我们不能直接把psk发送到ap来接入，否则可以被很容易的窃取到psk内容从而使加密失效。
AP发送一个随机数M1到客户端，客户端收到M1后也产生一个随机数M2，之后使用AP的mac地址，客户端的MAC地址，两个随机数和PMK来生成一个PTK。之后提取PTK的前16字节生成MIC Key。
## 第二次握手
客户端将M2和MIC Key发送到AP，AP计算出PTK以及检查MIC Key
## 第三次握手
AP确认客户端身份后告知客户端安装PTK用于后续加密
## 第四次握手
客户端回应AP，开始通信。
# 总结
WPA加密比wep加密更强，无法通过简单的抓包破解。只能考虑捕获四次握手包，使用字典不断计算MIC与PTK来暴力破解密码。如果密码足够复杂并且定期更换，可以认为wpa加密是十分安全的。